# 局所麻酔薬シミュレーター
## 概要
- 松本歯科大学の学生実習で行っていた局所麻酔薬の実習項目を
  コンピューター上で再現したシミュレーターです
- プログレッシブウェブアプリ (PWA) として作成しているため
  PCあるいはタブレットにインストールすることができます


## インストールおよび実行方法について
1. [このページ](https://toshi-ara.github.io/simla-ts/sim_local_anesthetics.html)
   にアクセスする
1. Windows PC（EdgeあるいはChromeが開く）およびAndroidの場合には
   インストールするように通知が表示される
   （インストールしなくても大丈夫です）
    - インストールした場合にはインターネットに接続していない状態でも
      アプリケーションを使用することができます
    - iPhoneあるいはiPadの場合にはメニューから"ホーム画面に追加"を選択して下さい


## 実習手順について
### シミュレーターの元となった動物実験の手順
1. モルモット背部の毛をシェーバーで刈り取る
1. 以下の薬物 0.1 ml を皮下注射する。その後、丘疹部の周囲を丸で囲む
    - Saline: 生理食塩水
    - Pro: プロカイン塩酸塩 (1%)
    - Lid: リドカイン塩酸塩 (1%)
    - Mep: メピバカイン塩酸塩 (1%)
    - Bup: ブピバカイン塩酸塩 (1%)
    - Lid + Adr: リドカイン塩酸塩 (1%) + アドレナリン (1/100,000)
1. 一定時間ごとに丘疹内を刺激針で6回刺激し、皮膚収縮を起こした回数を測定する
   （この値をスコア値とする）
    - 5分ごとに刺激を行い、120分まで観測する
1. スコア値6が3回連続した場合に、その薬物の効果が終了したと判定する
    - 終了後は刺激を行わなくてもよい
1. 各薬物のスコア値の合計および作用持続時間を比較する

### シミュレーターの使用方法について
1. **開始ボタン**を押すと測定を開始します
1. 円の内部を左クリックすると画面の左下に"反応あり"あるいは"反応なし"と表示されます。
   "反応あり"の場合には円が一時的に赤色に変化します
1. スライダーで時間経過の速度（倍）を変更することができます
    - 実行中・停止中のどちらの場合にも値を変更することが可能です
1. **一時停止ボタン**を押すと時間の経過が停止し、**再開ボタン**を押すと時間の経過が再開します
1. **新規実験ボタン**を押すと新しいパラメータ値で始めから実験を行うことができます
    - 異なる動物を使用して実験を行うことを意味します
1. **終了ボタン**を押してからプログラムを終了します
    - ブラウザ内にパラメーターの情報が残っているため、
      この操作を行って削除して下さい

### このシミュレーターの注意点について
- このシミュレーターは実際の実習結果をもとにモデル化したものですが、
  必ずしも動物実験と同じ結果が得られるとは限りません
    - 薬物のパラメーター値を乱数で設定しているため
      薬物の作用持続時間が本来の薬物の順序と異なる場合があります
        - v1.0.0から多変量正規分布に従う乱数を使用するように変更したため、
          この頻度は低下したと思います
    - 刺激した際の反応の有無を乱数で決定しているため
      反応回数が上下を繰り返し、必ずしも経時的に増加するとは限りません


## 参考文献
このシミュレーターで使用したモデル式およびパラメータ値の論文

- Toshiaki Ara and Hiroyuki Kitamura:
  Development of a Predictive Statistical Pharmacological Model
   for Local Anesthetic Agent Effects
   with Bayesian Hierarchical Model Parameter Estimation.
  Medicines 2023, 10(11), 61
  (https://doi.org/10.3390/medicines10110061)


## 環境構築について（教員用）
- MIT Licenseで公開しているため商用・非商用に限らず使用・改変可能です
- 以下の方法のいずれかで実習環境を構築します
    1. GitHub上に公開したページにアクセスする方法
        - https://toshi-ara.github.io/simla-ts/sim_local_anesthetics.html
        - 最も簡単ですが、学生がアクセスしやすいページ（教室独自のページなど）に
          このリンクを貼っておくといいと思います
    1. 学生のコンピューターにインストールする場合
        - このページの`Code`ボタンをクリックすると
          `Download ZIP`と表示されるためクリックします。
          `simla-ts-main.zip`という名前のファイルが保存されます
        - ファイルを解凍した後に
          `docs`フォルダの中身をコンピューターにコピーします
          （適宜フォルダ名を変更して下さい）
        - フォルダ内の`sim_local_anesthetics.html`をダブルクリックすると
          ブラウザが起動してシミュレーターを使用できます
    1. 自前のwebサーバに設置する場合（**詳しい方に相談して下さい**）
        - 上記の`docs`フォルダの中身をwebサーバの適切な場所に設置します
          （適宜フォルダ名を変更して下さい）
        - `sim_local_anesthetics.html`にアクセスするとシミュレーターを使用できます


## ソースコードを変更する場合（開発者限定）
### ライセンス表示について
- 改変する場合には`LICENSE`ファイルの
  `Copyright (c) 2022 ARA Toshiaki`以降に著作権者を追加した上で、
  その`LICENSE`ファイルをソースコードに含めて下さい

### ビルド方法
- npm（JavaScriptのパッケージ管理システム）が必要です
- npmをインストールした状態で以下のコマンドを実行します

```bash
git clone https://github.com/toshi-ara/simla-ts.git
# git clone git@github.com:toshi-ara/simla-ts.git  # sshを使用する場合
cd simla-ts

npm install
npm run build
```

### 別リポジトリのコードを使用
GitHub上の[別リポジトリのコード](https://github.com/toshi-ara/simla)
を使用することも可能です

- この場合にはnpmの必要はありません（ブラウザのみで動作します）


## 変更履歴
### v1.2.1 (2024-7-15)
- 画像部におけるピンチイン操作を無効化

### v1.2.0 (2024-1-26)
- 薬物のパラメータ値間の相関係数を更新

### v1.1.2 (2024-1-4)
- 反応ありの時にタイマーの文字色を赤色に変更

### v1.1.1 (2024-1-4)
- PWAアプリケーションとしてインストール後に起動に失敗するのを修正

### v1.1.0 (2024-1-4)
- 多変量正規分布に従う乱数発生に"multivariate-normal"パッケージを使用
    - Rスクリプトを廃止

### (2023-12-30)
- README.mdファイル（このページ）の内容を更新
    - 環境構築および参考文献の項目を追加
- README.mdの内容を英語に変更し、日本語ドキュメントはREADME-ja.mdに変更した

### v1.0.1 (2023-12-30)
- ソースコードのディレクトリ配置を変更
    - docs以下を公開するように変更
- それに伴い公開URLを変更
    - https://toshi-ara.github.io/simla-ts/sim_local_anesthetics.html

### v1.0.0 (2023-12-29)
- シミュレーション時における薬物のパラメータ値の設定方法を変更
    - 多変量正規分布に従う乱数を使用（各薬物間の相関係数0.8）


## このプログラムについて
- 作成者：松本歯科大学・薬理学講座 荒　敏昭
- 作成年：2022
- ライセンス：MITライセンス
